{% extends "base.html" %}
{% block content %}
<h2>Summary for {{ year }}-{{ month }}</h2>

<p><strong>Total Income:</strong> ${{ totals.income }}</p>
<p><strong>Total Expenses:</strong> ${{ totals.expense }}</p>

<h3>Breakdown by Category</h3>
<table class="table table-striped">
  <thead>
    <tr>
      <th>Category</th>
      <th>Amount</th>
    </tr>
  </thead>
  <tbody>
    {% for category, amount in breakdown %}
    <tr>
      <td>{{ category }}</td>
      <td>${{ amount }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<h3>Visuals</h3>
<div class="row">
  <div class="col-md-6">
    <h5>Category Breakdown</h5>
    <div id="pieChart"></div>
  </div>
  <div class="col-md-6">
    <h5>Daily Expenses</h5>
    <div id="lineChart"></div>
  </div>
</div>

<script>
  // Pie chart
  var pieData = [{
    values: {{ breakdown | map(attribute=1) | list | safe }},
    labels: {{ breakdown | map(attribute=0) | list | safe }},
    type: 'pie'
  }];
  Plotly.newPlot('pieChart', pieData, { title: 'Spending Breakdown' });

  // Line chart
  var lineData = [{
    x: {{ days | safe }},
    y: {{ amounts | safe }},
    type: 'scatter',
    mode: 'lines+markers',
    marker: { size: 8 }
  }];
  Plotly.newPlot('lineChart', lineData, { title: 'Daily Expenses' });
</script>
{% endblock %}
